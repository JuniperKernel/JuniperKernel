#!/bin/bash

ARCH=64
R_HOME=$(R RHOME)
RSCRIPT=${R_HOME}/bin/Rscript
R_LIB=$(${RSCRIPT} -e 'cat(.Library)')

# Decide OS
# Essentially switch between osx and Linux; fail if windows
SYS=''
unamestr=`uname`
if [[ `uname` == 'Linux' ]]; then
   SYS=linux
   DEPS="deps: lzmq"
   LINKER="-Wl,-R,'\$\$ORIGIN/../zmq'"
elif [[ `uname` == 'Darwin' ]]; then
   SYS=osx
   DEPS="deps: zmq"
   LINKER="-Wl,-rpath,${R_LIB}/JuniperKernel/zmq"
fi
sed -e"s|@rlib@|"${R_LIB}"|" -e"s|@arch@|"${ARCH}"|" -e"s|@sys@|"${SYS}"|" -e"s/@deps@/${DEPS}/"  -e"s|@LINKER@|"${LINKER}"|" src/Makevars.in > src/Makevars

exit 0

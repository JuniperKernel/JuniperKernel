#!/bin/bash

# Decide OS
# Essentially switch between osx and Linux; fail if windows
SYS=''
unamestr=`uname`
if [[ `uname` == 'Linux' ]]; then
   SYS=linux
   DEPS="deps: libxeus qstack"
elif [[ `uname` == 'Darwin' ]]; then
   SYS=osx
   DEPS="deps: libxeus qstack"
fi
ARCH=64
R_HOME=$(R RHOME)
RSCRIPT=${R_HOME}/bin/Rscript
R_LIB=$(${RSCRIPT} -e 'cat(.Library)')
sed -e"s|@rlib@|"${R_LIB}"|" -e"s|@arch@|"${ARCH}"|" -e"s|@sys@|"${SYS}"|" -e "s/@deps@/${DEPS}/" src/Makevars.in > src/Makevars

${RSCRIPT} -e 'Rcpp::compileAttributes()'
${RSCRIPT} -e 'roxygen2::roxygenize()'
exit 0

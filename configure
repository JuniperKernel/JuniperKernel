#!/bin/bash

: ${R_HOME=`R RHOME`}
RSCRIPT=${R_HOME}/bin/Rscript
PBD_ZMQ=`${RSCRIPT} -e "cat(system.file(package='pbdZMQ'))"`

# ZMQ_CPPFLAGS="-I${PBD_ZMQ}/zmq/include"
# ZMQ_LDFLAGS="-L${PBD_ZMQ}/libs -lzmq"
# if [[ `uname` == 'Darwin' ]]; then
#   ZMQ_LDFLAGS=`${RSCRIPT} -e "pbdZMQ::get.zmq.ldflags()"`
# fi
ZMQ_CPPFLAGS=`${RSCRIPT} -e "pbdZMQ::get.zmq.cppflags()"`
ZMQ_LDFLAGS=`${RSCRIPT} -e "pbdZMQ::get.zmq.ldflags()"`

RINSIDE=`${RSCRIPT} -e "RInside:::LdFlags()"`

XEUS_CPP_FILES=`${RSCRIPT} -e "cat(file.path('src', list.files('src/xeus/src', pattern='*cpp$')))"`
XEUS_OBJ_FILES=`${RSCRIPT} -e "cat(gsub('cpp', 'o', file.path('src', list.files('src/xeus/src', pattern='*cpp$'))))"`

echo " "
echo "************** Results of JuniperKernel package configure **************"
echo " "
echo ">> RSCRIPT = ${RSCRIPT}"
echo ">> PBD_ZMQ = ${PBD_ZMQ}"
echo ">> ZMQ_CPPFLAGS = ${ZMQ_CPPFLAGS}"
echo ">> ZMQ_LDFLAGS = ${ZMQ_LDFLAGS}"
echo ">> RINSIDE = ${RINSIDE}"
echo " "
echo "************************************************************************"
echo " "

sed -e "s|@ZMQ_CPPFLAGS@|${ZMQ_CPPFLAGS}|" -e "s|@ZMQ_LDFLAGS@|${ZMQ_LDFLAGS}|" src/Makevars.in > src/Makevars
sed -e "s|@RINSIDE@|${RINSIDE}|" src/jk_main/Makefile.in > src/jk_main/Makefile
sed -e "s|@XEUS_CPP_FILES@|${XEUS_CPP_FILES}|" -e "s|@XEUS_OBJ_FILES@|${XEUS_OBJ_FILES}|" src/xeus/Makefile.in > src/xeus/Makefile
exit 0
